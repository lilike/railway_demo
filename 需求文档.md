需求文档：Railway HTTP 接口版 Playwright 爬虫 Demo

1. 目标

在 Railway 部署一个 Python + Playwright 爬虫项目，通过 HTTP 接口接收请求，爬取指定网页，并返回结果（标题与 HTML）。

⸻

2. 技术栈
	•	语言：Python 3.11+
	•	Web 框架：Flask（轻量级 HTTP 服务）
	•	爬虫框架：Playwright（Chromium）
	•	部署平台：Railway

⸻

3. 功能需求

3.1 接口说明
	•	请求方式：GET
	•	接口路径：/crawl
	•	参数：
	•	url（必填）— 要爬取的网页 URL
	•	返回值：JSON

{
  "title": "页面标题",
  "html": "<!DOCTYPE html>..."
}



3.2 示例调用

curl "https://<railway域名>/crawl?url=https://example.com"


⸻

4. 项目结构

railway-playwright-api/
├── main.py
├── requirements.txt
├── Procfile
└── start.sh


⸻

5. 文件内容

5.1 requirements.txt

flask
playwright

5.2 start.sh

#!/bin/bash
# 安装 Chromium 浏览器
playwright install chromium
# 启动 Flask 应用
python main.py

5.3 Procfile

web: bash start.sh

5.4 main.py

from flask import Flask, request, jsonify
from playwright.sync_api import sync_playwright

app = Flask(__name__)

@app.route("/crawl", methods=["GET"])
def crawl():
    url = request.args.get("url")
    if not url:
        return jsonify({"error": "Missing 'url' parameter"}), 400

    try:
        with sync_playwright() as p:
            browser = p.chromium.launch(headless=True)
            page = browser.new_page()
            page.goto(url, timeout=30000)
            title = page.title()
            html = page.content()
            browser.close()
        return jsonify({"title": title, "html": html})
    except Exception as e:
        return jsonify({"error": str(e)}), 500

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000)


⸻

6. 验证方式
	1.	推送代码到 GitHub 并连接 Railway 部署。
	2.	部署成功后，在浏览器或终端运行：

curl "https://<railway域名>/crawl?url=https://example.com"


	3.	正常返回 JSON 数据即验证成功。

⸻

7. 可选增强
	•	添加截图返回功能：

page.screenshot(path="/tmp/screenshot.png")


	•	添加渲染延时等待 JS：

page.wait_for_load_state("networkidle")


